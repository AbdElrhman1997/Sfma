"use client"; // Required for client-side interactivity

import { useLocale, useTranslations } from "next-intl";
import Link from "next/link";
import { useEffect, useState } from "react";
import ProfileClient from "./ClientTab";
import Image from "next/image";
import ClientTab from "./ClientTab";
import CoursesTab from "./CoursesTab";
import ExamsTab from "./ExamsTab";
import CertificatesTab from "./CertificatesTab";
import MembershipTab from "./MembershipTab";
import PaymentsTab from "./PaymentsTab";

const ProfilePage = () => {
  const [activeTab, setActiveTab] = useState(1);
  const lang = useLocale();
  const [content, setContent] = useState([]);
  const [profileData, setProfileData] = useState(null);
  const tabs = [
    {
      id: 1,
      name: "profile_data",
      label: "المعلومات الشخصية",
      icon: (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="26"
          height="31"
          viewBox="0 0 26 31"
          fill="none"
        >
          <path
            d="M20.7995 8.38342C20.7894 12.7119 17.2878 16.231 12.9933 16.231C8.68874 16.231 5.18712 12.6863 5.19729 8.34756C5.20237 4.01911 8.70907 0.5 12.9984 0.5C17.303 0.5 20.8097 4.04472 20.7995 8.38342Z"
            fill="#898989"
          />
          <path
            d="M25.366 30.5H0.631104C0.117805 30.2644 -0.0194132 29.8494 -0.0092489 29.3013C0.0923945 23.9484 4.14288 19.1948 9.37243 18.3291C10.023 18.2215 10.6938 18.1754 11.3545 18.1601C12.5285 18.1344 13.7024 18.1191 14.8764 18.1601C19.3335 18.324 22.5912 20.4549 24.7257 24.3633C25.5642 25.9001 25.9301 27.5802 26.0064 29.3321C26.0267 29.8751 25.8641 30.2695 25.366 30.5Z"
            fill="#898989"
          />
        </svg>
      ),
    },
    {
      id: 2,
      name: "courses",
      label: "دوراتي التدريبية",
      icon: (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="30"
          height="25"
          viewBox="0 0 30 25"
          fill="none"
        >
          <path
            d="M11.6293 1.62497C9.37133 0.547017 6.21534 0.0189757 1.99007 0.000228662C1.59158 -0.0051848 1.20092 0.111004 0.870164 0.333301C0.598679 0.51679 0.376446 0.764175 0.223011 1.0537C0.0695765 1.34322 -0.0103583 1.666 -0.00976232 1.99366V19.8721C-0.00976232 21.0806 0.850166 21.9924 1.99007 21.9924C6.43157 21.9924 10.8868 22.4073 13.5554 24.9294C13.5919 24.9641 13.6377 24.9872 13.6873 24.996C13.7369 25.0048 13.7879 24.9989 13.8341 24.9789C13.8803 24.9589 13.9197 24.9258 13.9472 24.8837C13.9747 24.8416 13.9893 24.7923 13.9891 24.7419V3.6759C13.9891 3.53377 13.9587 3.39329 13.8998 3.26393C13.841 3.13456 13.755 3.01934 13.6478 2.92602C13.0366 2.4035 12.3576 1.96586 11.6293 1.62497ZM29.1078 0.331426C28.7769 0.109683 28.3862 -0.0058576 27.9879 0.000228662C23.7626 0.0189757 20.6066 0.544518 18.3487 1.62497C17.6204 1.96524 16.9412 2.40201 16.3295 2.92352C16.2225 3.01697 16.1368 3.13224 16.078 3.26158C16.0193 3.39093 15.9889 3.53134 15.9889 3.6734V24.7407C15.9889 24.7891 16.0031 24.8364 16.0299 24.8767C16.0566 24.917 16.0947 24.9485 16.1393 24.9672C16.1839 24.986 16.233 24.9911 16.2805 24.9821C16.328 24.973 16.3718 24.9501 16.4064 24.9163C18.0106 23.3228 20.826 21.9905 27.9904 21.9911C28.5208 21.9911 29.0295 21.7804 29.4045 21.4054C29.7795 21.0304 29.9902 20.5218 29.9902 19.9914V1.99429C29.991 1.66598 29.9108 1.34254 29.7569 1.05254C29.603 0.762527 29.3801 0.514868 29.1078 0.331426Z"
            fill="#1DAEE5"
          />
        </svg>
      ),
    },
    {
      id: 3,
      name: "exams",
      label: "الاختبارات",
      icon: (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="30"
          height="31"
          viewBox="0 0 30 31"
          fill="none"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M27.4902 6.33333C26.8272 6.33333 26.1913 6.59672 25.7225 7.06557C25.2536 7.53441 24.9902 8.17029 24.9902 8.83333V10.5H29.9902V8.83333C29.9902 8.17029 29.7268 7.53441 29.258 7.06557C28.7892 6.59672 28.1533 6.33333 27.4902 6.33333ZM29.9902 12.1667H24.9902V25.9167L27.4902 29.6667L29.9902 25.9167V12.1667ZM-0.00976562 3V28C-0.00976562 28.663 0.253627 29.2989 0.722467 29.7678C1.19131 30.2366 1.82719 30.5 2.49023 30.5H20.8236C21.4866 30.5 22.1225 30.2366 22.5913 29.7678C23.0602 29.2989 23.3236 28.663 23.3236 28V3C23.3236 2.33696 23.0602 1.70107 22.5913 1.23223C22.1225 0.763392 21.4866 0.5 20.8236 0.5H2.49023C1.82719 0.5 1.19131 0.763392 0.722467 1.23223C0.253627 1.70107 -0.00976562 2.33696 -0.00976562 3ZM11.6569 8C11.6569 7.77899 11.7447 7.56702 11.901 7.41074C12.0573 7.25446 12.2692 7.16667 12.4902 7.16667H19.1569C19.3779 7.16667 19.5899 7.25446 19.7462 7.41074C19.9024 7.56702 19.9902 7.77899 19.9902 8C19.9902 8.22101 19.9024 8.43297 19.7462 8.58926C19.5899 8.74554 19.3779 8.83333 19.1569 8.83333H12.4902C12.2692 8.83333 12.0573 8.74554 11.901 8.58926C11.7447 8.43297 11.6569 8.22101 11.6569 8ZM12.4902 10.5C12.2692 10.5 12.0573 10.5878 11.901 10.7441C11.7447 10.9004 11.6569 11.1123 11.6569 11.3333C11.6569 11.5543 11.7447 11.7663 11.901 11.9226C12.0573 12.0789 12.2692 12.1667 12.4902 12.1667H19.1569C19.3779 12.1667 19.5899 12.0789 19.7462 11.9226C19.9024 11.7663 19.9902 11.5543 19.9902 11.3333C19.9902 11.1123 19.9024 10.9004 19.7462 10.7441C19.5899 10.5878 19.3779 10.5 19.1569 10.5H12.4902ZM11.6569 18.8333C11.6569 18.6123 11.7447 18.4004 11.901 18.2441C12.0573 18.0878 12.2692 18 12.4902 18H19.1569C19.3779 18 19.5899 18.0878 19.7462 18.2441C19.9024 18.4004 19.9902 18.6123 19.9902 18.8333C19.9902 19.0543 19.9024 19.2663 19.7462 19.4226C19.5899 19.5789 19.3779 19.6667 19.1569 19.6667H12.4902C12.2692 19.6667 12.0573 19.5789 11.901 19.4226C11.7447 19.2663 11.6569 19.0543 11.6569 18.8333ZM12.4902 21.3333C12.2692 21.3333 12.0573 21.4211 11.901 21.5774C11.7447 21.7337 11.6569 21.9457 11.6569 22.1667C11.6569 22.3877 11.7447 22.5996 11.901 22.7559C12.0573 22.9122 12.2692 23 12.4902 23H19.1569C19.3779 23 19.5899 22.9122 19.7462 22.7559C19.9024 22.5996 19.9902 22.3877 19.9902 22.1667C19.9902 21.9457 19.9024 21.7337 19.7462 21.5774C19.5899 21.4211 19.3779 21.3333 19.1569 21.3333H12.4902ZM4.99023 18.8333V21.3333H7.49023V18.8333H4.99023ZM4.1569 17.1667H8.32357C8.54458 17.1667 8.75654 17.2545 8.91282 17.4107C9.0691 17.567 9.1569 17.779 9.1569 18V22.1667C9.1569 22.3877 9.0691 22.5996 8.91282 22.7559C8.75654 22.9122 8.54458 23 8.32357 23H4.1569C3.93589 23 3.72393 22.9122 3.56765 22.7559C3.41137 22.5996 3.32357 22.3877 3.32357 22.1667V18C3.32357 17.779 3.41137 17.567 3.56765 17.4107C3.72393 17.2545 3.93589 17.1667 4.1569 17.1667ZM9.74607 8.58917C9.89787 8.432 9.98186 8.2215 9.97996 8.003C9.97806 7.7845 9.89042 7.57549 9.73592 7.42098C9.58141 7.26648 9.3724 7.17884 9.1539 7.17694C8.9354 7.17504 8.7249 7.25904 8.56773 7.41083L5.82357 10.155L4.74607 9.0775C4.5889 8.9257 4.3784 8.84171 4.1599 8.8436C3.9414 8.8455 3.73239 8.93314 3.57789 9.08765C3.42338 9.24216 3.33574 9.45117 3.33384 9.66967C3.33194 9.88816 3.41594 10.0987 3.56773 10.2558L5.82357 12.5117L9.74607 8.58917Z"
            fill="#898989"
          />
        </svg>
      ),
    },
    {
      id: 4,
      name: "certificates",
      label: "الشهادات",
      icon: (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="30"
          height="31"
          viewBox="0 0 30 31"
          fill="none"
        >
          <g clip-path="url(#clip0_1321_3945)">
            <path
              d="M16.5605 1.1098L17.2626 1.75206C17.8435 2.28514 18.6541 2.48424 19.4137 2.28514L20.3328 2.0475C21.4945 1.74564 22.6945 2.38148 23.1094 3.51186L23.435 4.41102C23.703 5.15604 24.3286 5.70839 25.0945 5.88822L26.0201 6.10659C27.1881 6.38276 27.9605 7.50672 27.8009 8.70132L27.6733 9.65187C27.5711 10.4354 27.8647 11.219 28.4584 11.7392L29.1796 12.3686C30.086 13.1586 30.252 14.5138 29.5562 15.5029L29.0073 16.2864C28.5541 16.9351 28.452 17.7636 28.7392 18.5022L29.0839 19.395C29.5243 20.5189 29.0392 21.797 27.9733 22.3429L27.1243 22.7797C26.4222 23.1393 25.9499 23.8266 25.8669 24.6165L25.7647 25.5671C25.6307 26.7681 24.6158 27.6737 23.4158 27.6609L22.4647 27.648C21.6796 27.6416 20.9392 28.0269 20.5052 28.6821L19.9754 29.4785C19.3052 30.4804 17.9903 30.8079 16.9307 30.2363L16.0945 29.7803C15.4052 29.4078 14.569 29.4078 13.8796 29.7803L13.0435 30.2363C11.9839 30.8079 10.669 30.4804 9.99879 29.4785L9.469 28.6821C9.02857 28.0269 8.29453 27.6352 7.50942 27.648L6.55836 27.6609C5.35836 27.6737 4.34347 26.7681 4.20942 25.5671L4.1073 24.6165C4.02432 23.833 3.54559 23.1393 2.84985 22.7797L2.00091 22.3429C0.928572 21.7906 0.449848 20.5189 0.890274 19.395L1.23495 18.5022C1.52219 17.7636 1.42006 16.9351 0.96687 16.2864L0.417933 15.5029C-0.277811 14.5138 -0.111854 13.165 0.794529 12.3686L1.51581 11.7392C2.10942 11.219 2.40304 10.4354 2.30091 9.65187L2.17325 8.70132C2.01368 7.50672 2.78602 6.38276 3.9541 6.10659L4.87964 5.88822C5.64559 5.70839 6.27113 5.14962 6.53921 4.41102L6.86474 3.51186C7.27964 2.37505 8.47964 1.74564 9.64134 2.0475L10.5605 2.28514C11.3201 2.48424 12.1307 2.28514 12.7116 1.75206L13.4137 1.1098C14.3137 0.294129 15.6669 0.294129 16.5605 1.1098Z"
              fill="#898989"
            />
          </g>
          <defs>
            <clipPath id="clip0_1321_3945">
              <rect
                width="30"
                height="30"
                fill="white"
                transform="translate(-0.00976562 0.5)"
              />
            </clipPath>
          </defs>
        </svg>
      ),
    },
    {
      id: 5,
      name: "mempership",
      label: "العضوية",
      icon: (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="30"
          height="23"
          viewBox="0 0 30 23"
          fill="none"
        >
          <path
            d="M26.571 0.78653C22.7097 0.785637 18.8493 0.78653 14.9889 0.78653C11.1285 0.78653 7.26809 0.785637 3.4068 0.78653C1.35209 0.78653 -0.00820361 2.14795 -0.00909619 4.2048C-0.00998877 9.0693 -0.00998877 13.9347 -0.00909619 18.7992C-0.00820361 20.8525 1.35476 22.2148 3.41037 22.2148H26.5737C28.6302 22.2148 29.9896 20.8534 29.9896 18.7956C29.9905 13.9311 29.9905 9.06573 29.9896 4.20123C29.9896 2.14438 28.6293 0.78653 26.571 0.78653ZM13.8509 17.9279C11.0392 17.9306 8.22762 17.9306 5.4151 17.9279C4.71532 17.927 4.27528 17.4681 4.27796 16.7647C4.28688 14.1954 6.29251 11.9091 8.83992 11.5618C8.93543 11.5484 9.03004 11.5234 9.17196 11.494C7.26363 10.9467 6.21485 9.55495 6.438 7.92303C6.6656 6.25719 8.02321 5.05915 9.66734 5.07254C11.2793 5.08682 12.6075 6.27505 12.8253 7.92303C12.9904 9.17464 12.3317 10.9878 10.0788 11.494C10.368 11.5484 10.5956 11.5859 10.8214 11.635C13.1948 12.151 14.98 14.348 14.9889 16.7647C14.9916 17.4708 14.5542 17.927 13.8509 17.9279ZM22.3893 14.714C20.671 14.7167 18.9528 14.7167 17.2346 14.714C16.5518 14.7132 16.0671 14.2695 16.0627 13.6517C16.0582 13.0161 16.5429 12.5742 17.2498 12.5724C18.1093 12.5706 18.968 12.5715 19.8276 12.5715C20.6755 12.5715 21.5235 12.5706 22.3714 12.5724C23.0765 12.5742 23.5648 13.0196 23.5603 13.6508C23.5559 14.2704 23.073 14.7132 22.3893 14.714ZM24.4904 10.428C23.2854 10.4307 22.0813 10.4289 20.8763 10.4289C19.6723 10.4289 18.4673 10.4307 17.2623 10.4289C16.5527 10.4271 16.0645 9.9906 16.0627 9.36033C16.0609 8.72649 16.5447 8.28727 17.2543 8.28637C19.6642 8.28548 22.0733 8.28548 24.4824 8.28727C25.1884 8.28727 25.6695 8.73274 25.6623 9.37015C25.6561 9.99238 25.1795 10.4271 24.4904 10.428Z"
            fill="#898989"
          />
        </svg>
      ),
    },
    {
      id: 6,
      name: "payments",
      label: "مدفوعاتي",
      icon: (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="30"
          height="31"
          viewBox="0 0 30 31"
          fill="none"
        >
          <path
            d="M22.4627 2.4969C20.4986 1.38006 18.4005 0.717055 16.1465 0.547357C16.0716 0.541438 15.9966 0.515786 15.9217 0.5H14.0464C13.508 0.574983 12.9657 0.634179 12.4294 0.726921C9.02182 1.31692 6.15853 2.91523 3.84345 5.47253C1.77486 7.75555 0.550271 10.4451 0.120384 13.4957C0.0710848 13.8508 0.0336175 14.208 -0.00976562 14.5652V16.4417C0.0671409 17.0001 0.124328 17.5625 0.222926 18.1189C0.842122 21.5681 2.47885 24.453 5.09564 26.7715C7.34762 28.7645 9.97822 29.9879 12.9598 30.3628C17.59 30.9449 21.6798 29.6761 25.1347 26.5288C27.7909 24.1057 29.3389 21.0689 29.8477 17.5053C30.6956 11.554 27.7002 5.48042 22.4627 2.4969ZM17.0714 22.9376C16.9866 22.9652 16.9018 22.9869 16.8189 23.0145C16.3122 23.1724 16.1879 23.3519 16.1899 23.8886C16.1938 24.3089 16.1919 24.7292 16.1741 25.1476C16.1564 25.5856 15.973 25.7514 15.5293 25.7612C15.3045 25.7672 15.0797 25.7632 14.8549 25.7632C14.8549 25.7632 14.8549 25.7652 14.8549 25.7672C14.6399 25.7672 14.425 25.7691 14.212 25.7652C13.7565 25.7553 13.5731 25.5856 13.5494 25.1298C13.5317 24.7884 13.5396 24.4451 13.5337 24.1037C13.5218 23.4407 13.4824 23.4289 12.8454 23.2908C12.0961 23.127 11.3546 22.9178 10.6171 22.7067C10.3963 22.6435 10.1932 22.5113 9.98808 22.3989C9.73567 22.2607 9.62326 22.0417 9.70017 21.7595C9.88554 21.0847 10.0689 20.4059 10.2799 19.739C10.3805 19.4213 10.5442 19.3877 10.8833 19.5219C11.4789 19.7567 12.0665 20.027 12.6818 20.2066C13.4982 20.4434 14.3382 20.5953 15.1901 20.3684C15.4327 20.3033 15.6792 20.2184 15.8961 20.0961C16.7775 19.6048 16.9471 18.5116 16.2076 17.8289C15.8507 17.4993 15.3991 17.2547 14.9554 17.0396C14.0444 16.5996 13.088 16.2483 12.1927 15.7807C11.2403 15.2834 10.4692 14.5652 10.063 13.5312C9.25451 11.4751 10.2385 9.11905 12.3209 8.13244C12.6364 7.98247 12.9657 7.85421 13.2951 7.73582C13.5928 7.63124 13.7348 7.43392 13.7368 7.12412C13.7387 6.70382 13.7407 6.28353 13.7526 5.86323C13.7664 5.38571 13.8926 5.25547 14.3698 5.24561C14.7997 5.23772 15.2295 5.23772 15.6594 5.24956C16.1307 5.26337 16.2629 5.38768 16.3023 5.86126C16.3279 6.18092 16.322 6.50453 16.3279 6.82814C16.3398 7.34315 16.4344 7.4201 16.9452 7.54047C17.6629 7.71017 18.3807 7.89368 19.0808 8.12652C19.6527 8.31595 19.7296 8.533 19.5639 9.11313C19.42 9.62025 19.28 10.1274 19.1202 10.6286C18.9546 11.1475 18.7909 11.2186 18.2979 10.9857C17.31 10.5141 16.2707 10.2852 15.1783 10.3582C14.845 10.3799 14.494 10.4451 14.1923 10.5832C13.3227 10.9818 13.1728 11.9861 13.9162 12.5821C14.3579 12.9372 14.8845 13.1938 15.3991 13.4444C16.1603 13.8153 16.9629 14.1054 17.7122 14.4981C19.3115 15.3406 20.2206 16.6765 20.2975 18.4998C20.3823 20.4769 19.0433 22.2785 17.0714 22.9376Z"
            fill="#898989"
          />
        </svg>
      ),
    },
  ];

  const t = useTranslations("Register");

  useEffect(() => {
    const fetchProfile = async () => {
      const token = localStorage.getItem("auth_token");
      const res = await fetch(
        `${process.env.NEXT_PUBLIC_API_URL}user-profile`,
        {
          headers: {
            Authorization: `Bearer ${token}`,
            "Accept-Language": lang || "ar",
          },
        }
      );

      const data = await res.json();
      setProfileData(data?.data || {});
    };

    fetchProfile();
  }, [lang]);

  return (
    <section dir={lang === "en" ? "ltr" : "rtl"} className="p-0">
      <div className="bg-[#F6F6F6] py-14">
        <div className="md:w-1/5 w-4/5 mx-auto">
          {profileData?.logo ? (
            <Image
              src={`https://sfma.srv814693.hstgr.cloud/storage/${profileData?.logo}`}
              alt="Profile Logo"
              width={200}
              height={200}
              className="object-cover w-full h-full rounded-lg overflow-hidden"
            />
          ) : (
            <div className="w-full h-[200px] flex items-center justify-center bg-white rounded-lg border border-gray-300">
              {/* Default SVG or Icon */}
              <Image
                src={`/images/logos/profile.jpg`}
                alt="Profile Logo"
                width={200}
                height={200}
                className="object-cover w-full h-full rounded-lg"
              />
            </div>
          )}
        </div>

        <p className="text-2xl md:text-3xl font-bold text-center mt-3 md:mt-6">
          {t("welcome")} ,{" "}
          {lang == "en" ? profileData?.full_name_en : profileData?.full_name_ar}
        </p>
      </div>

      {/* Tabs */}
      <div className="shadow-lg pt-2 mb-10 ">
        <div className="container mx-auto overflow-x-auto scrollbar-hide">
          <div className="flex w-max sm:w-auto flex-nowrap sm:flex-wrap justify-start sm:justify-between gap-2 px-4">
            {tabs.map((tab) => (
              <button
                key={tab.id}
                className={`py-2 px-4 font-bold focus:outline-none min-w-[14rem] md:min-w-[10rem] cursor-pointer transition ease-in-out duration-300 flex items-center gap-3 whitespace-nowrap ${
                  activeTab === tab.id
                    ? "text-black border-b-4 border-[var(--main)]"
                    : "text-[#898989] hover:text-gray-700"
                }`}
                onClick={() => setActiveTab(tab.id)}
              >
                <div>{tab.icon}</div>
                <div>{tab.label}</div>
              </button>
            ))}
          </div>
        </div>
      </div>

      {!profileData ? (
        <></>
      ) : (
        <div className="container mx-auto">
          {activeTab == 1 ? (
            <ClientTab profileData={profileData} />
          ) : activeTab == 2 ? (
            <CoursesTab />
          ) : activeTab == 3 ? (
            <ExamsTab profileData={profileData} />
          ) : activeTab == 4 ? (
            <CertificatesTab />
          ) : activeTab == 5 ? (
            <MembershipTab profileData={profileData} />
          ) : (
            <PaymentsTab profileData={profileData} />
          )}
        </div>
      )}
    </section>
  );
};

export default ProfilePage;
